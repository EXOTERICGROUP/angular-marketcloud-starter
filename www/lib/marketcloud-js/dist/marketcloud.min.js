/*

*	Marketcloud Javascript SDK
*   http://www.marketcloud.it
*
*	Copyright (c) 2015 Herapi SRLS
*
*	Written by Mattia Alfieri <m.alfieri@marketcloud.it>
*

*/
(function(){function k(){window.DEBUG&&console.log(Array.prototype.slice.call(arguments))}function l(c,b,a){var f="",d;for(d in c)a&&b[a]&&0!==b[a].indexOf(c[d])&&(f+=a),f=b[d]?f+d:f+("["+d+"]"),c[d]instanceof Array?f+=l(c[d],b,d):c[d]instanceof Object?f+=l(c[d],b):(f+="="+c[d],f+="&");return f}function p(){try{return new XMLHttpRequest}catch(c){}try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}return null}
Request=function(c){var b=new p;b.open(c.method,c.url,!0);b.onreadystatechange=function(){if(4===b.readyState)if(3<Number(b.status.toString()[0])){if(c.hasOwnProperty("error")){if("function"!==typeof c.error)throw Error("error must be function");k(JSON.parse(b.responseText));c.error(JSON.parse(b.responseText),b.status)}}else if(c.hasOwnProperty("success")){if("function"!==typeof c.success)throw Error("success must be function");k(JSON.parse(b.responseText));c.success(JSON.parse(b.responseText),b.status)}};
b.setRequestHeader("Content-Type","application/json");if(c.hasOwnProperty("headers"))for(var a in c.headers)b.setRequestHeader(a,c.headers[a]);k("Firing this request object ",c);c.hasOwnProperty("data")?b.send(JSON.stringify(c.data)):b.send()};var e=function(c,b,a,f){a={success:a,error:f,headers:{}};a.headers.Authorization=null===d.token?d["public"]:d["public"]+":"+d.token;0>c.indexOf("http://")&&(a.url=d.baseUrl+c);0<Object.keys(b).length&&(c=a.url,b=l(b,b),b=encodeURI(b.substring(0,b.length-1).split(" ").join("+")),
a.url=c+("?"+b));a.method="GET";return Request(a)},h=function(c,b,a){b={success:b,error:a,headers:{}};b.headers.Authorization=null===d.token?d["public"]:d["public"]+":"+d.token;0>c.indexOf("http://")&&(b.url=d.baseUrl+c);b.method="DELETE";return Request(b)},g=function(c,b,a,f){b={success:a,error:f,data:b,headers:{}};b.headers.Authorization=null===d.token?d["public"]:d["public"]+":"+d.token;0>c.indexOf("http://")&&(b.url=d.baseUrl+c);b.method="POST";return Request(b)},m=function(c,b,a,f){b={success:a,
error:f,data:b,headers:{}};b.headers.Authorization=null===d.token?d["public"]:d["public"]+":"+d.token;0>c.indexOf("http://")&&(b.url=d.baseUrl+c);b.method="PATCH";return Request(b)},n=function(c,b,a,f){b={success:a,error:f,data:b,headers:{}};b.headers.Authorization=null===d.token?d["public"]:d["public"]+":"+d.token;0>c.indexOf("http://")&&(b.url=d.baseUrl+c);b.method="PUT";return Request(b)},q="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||
this,d={"public":null,token:null,baseUrl:"http://api.marketcloud.it/v0",addresses:{},brands:{},carts:{},categories:{},currencies:{},orders:{},products:{},shippings:{},stores:{},taxes:{},users:{}};d.brands.list=function(c,b){var a=a||{};e("/brands",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.brands.getById=function(c,b){e("/brands/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.addresses.create=function(c,b){g("/addresses/",c,function(a){b(null,a.data)},
function(a){b(a.errors[0],null)})};d.addresses.update=function(c,b,a){n("/addresses/"+c,b,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.addresses["delete"]=function(c,b){h("/addresses/"+c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.addresses.list=function(c,b){var a=a||{};e("/addresses",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.addresses.getById=function(c,b){e("/addresses/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],
null)})};d.categories.list=function(c,b){var a=a||{};e("/categories",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.categories.getById=function(c,b){e("/categories/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.currencies.list=function(c,b){var a=a||{};e("/currencies",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.currencies.getById=function(c,b){e("/currencies/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.orders.create=
function(c,b){g("/orders/",c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.orders.list=function(c,b){var a=a||{};e("/orders",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.orders.getById=function(c,b){e("/orders/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.products.list=function(c,b){var a=a||{};e("/products",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.products.getById=function(c,b){e("/products/"+c,{},function(a){b(null,
a.data)},function(a){b(a.errors[0],null)})};d.shippings.list=function(c,b){var a=a||{};e("/shippings",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.shippings.getById=function(c,b){e("/shippings/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.stores.create=function(c,b){g("/stores/",c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.stores.update=function(c,b,a){n("/stores/"+c,b,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};
d.stores["delete"]=function(c,b){h("/stores/"+c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.stores.list=function(c,b){var a=a||{};e("/stores",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.stores.getById=function(c,b){e("/stores/"+c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.taxes.list=function(c,b){var a=a||{};e("/taxes",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.taxes.getById=function(c,b){e("/taxes/"+c,{},function(a){b(null,
a.data)},function(a){b(a.errors[0],null)})};d.users.create=function(c,b){g("/users/",c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.users.update=function(c,b,a){n("/users/"+c,b,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.users["delete"]=function(c,b){h("/users/"+c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.users.list=function(c,b){var a=a||{};e("/users",a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.users.getById=function(c,
b){e("/users/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.users.getCurrent=function(c){e("/users/"+d.user.id,{},function(b){c(null,b.data)},function(b){c(b.errors[0],null)})};d.users.authenticate=function(c,b,a){d.token=null;d.user=null;g("/users/"+c+"/authenticate",{password:b},function(b){d.token=b.data.token;d.user=b.data.user;a(null,b.data)},function(b){a(b.errors[0],null)})};d.carts.create=function(c,b){var a=null,a=c instanceof Array?{items:c}:c;g("/carts",a,function(a){b(null,
a.data)},function(a){b(a.errors[0],null)})};d.carts.add=function(c,b,a){if(b instanceof Array)m("/carts/"+c,[{op:"add",items:b}],function(b){a(null,b.data)},function(b){a(b.errors[0],null)});else throw Error("addToCart(cart_id,data,callback) data must be an array [{product_id :1,quantity : 7}]");};d.carts.remove=function(c,b,a){if(b instanceof Array)m("/carts/"+c,[{op:"remove",items:b}],function(b){a(null,b.data)},function(b){a(b.errors[0],null)});else throw Error("removeFromCart(cart_id,data,callback) data must be an array [{product_id :1,product_id : 7}]");
};d.carts.update=function(c,b,a){if(b instanceof Array)m("/carts/"+c,[{op:"update",items:b}],function(b){a(null,b.data)},function(b){a(b.errors[0],null)});else throw Error("removeFromCart(cart_id,data,callback) data must be an array [{product_id :1,product_id : 7}]");};d.carts.getById=function(c,b){e("/carts/"+c,{},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.carts.getByUser=function(c,b){e("/carts",{owner:c},function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.carts.checkout=
function(c,b){if("number"!==typeof c.cart_id)throw Error("marketcloud.carts.checkout(data,callback) data.cart_id must be Integer.");if("object"!==typeof c.billing_address)throw Error("marketcloud.carts.checkout(data,callback) data.billing_address must be Object.");if("object"!==typeof c.shipping_address)throw Error("marketcloud.carts.checkout(data,callback) data.shipping_address must be Object.");g("/carts/"+c.cart_id+"/checkout",c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.carts["delete"]=
function(c,b){h("/carts/"+c,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};q.marketcloud=d})();